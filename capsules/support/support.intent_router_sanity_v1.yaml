id: support.intent_router_sanity_v1
version: 1.0.0
domain: support
title: Intent Router Sanity Check
statement: 'Validate that baseline rules classify common support intents correctly.
  Defaults read

  fixtures under artifacts/examples/support_agent/. Accuracy must meet or exceed 0.8.'
assumptions: null
pedagogy: null
witnesses:
- name: routes_top_intents_correctly
  language: python
  code: "import os, sys, json, re\n\ndef load_json(path):\n    with open(path, \"\
    r\") as f:\n        return json.load(f)\n\ndef classify(text, rules):\n    text_l\
    \ = text.lower()\n    for intent, pats in rules.items():\n        for pat in pats:\n\
    \            if re.search(pat, text_l):\n                return intent\n    return\
    \ \"unknown\"\n\ndef main():\n    intents_path = os.environ.get(\"INTENTS_JSON\"\
    , \"\").strip()\n    rules_path = os.environ.get(\"RULES_JSON\", \"\").strip()\n\
    \    acc_threshold = float(os.environ.get(\"ACC_THRESHOLD\", \"0.8\"))\n\n   \
    \ if not intents_path or not rules_path:\n        print(json.dumps({\"ok\": False,\
    \ \"error\": \"INTENTS_JSON or RULES_JSON not set\"}))\n        sys.exit(2)\n\n\
    \    intents = load_json(intents_path)  # list of {text, expected}\n    rules\
    \ = load_json(rules_path)      # {intent: [regex,...]}\n\n    total = len(intents)\n\
    \    correct = 0\n    details = []\n\n    for item in intents:\n        text =\
    \ item[\"text\"]\n        expected = item[\"expected\"]\n        pred = classify(text,\
    \ rules)\n        correct += 1 if pred == expected else 0\n        details.append({\"\
    text\": text, \"expected\": expected, \"pred\": pred})\n\n    acc = (correct /\
    \ total) if total else 0.0\n    ok = acc >= acc_threshold\n\n    print(json.dumps({\"\
    ok\": ok, \"accuracy\": acc, \"threshold\": acc_threshold, \"total\": total, \"\
    correct\": correct, \"details\": details}, indent=2))\n    sys.exit(0 if ok else\
    \ 1)\n\nif __name__ == \"__main__\":\n    main()"
  env:
    INTENTS_JSON: artifacts/examples/support_agent/intents.json
    RULES_JSON: artifacts/examples/support_agent/router_rules.json
    ACC_THRESHOLD: '0.8'
  success_message: Intent router accuracy meets threshold.
  failure_message: Intent router below threshold â€” refine rules or examples.
provenance:
  schema: provenance.v1
  author: John Macgregor
  org: Truth Capsules Demo
  license: MIT
  source_url: https://example.com/truth-capsules/support
  created: '2025-11-10T18:12:37Z'
  updated: '2025-11-10T18:12:37Z'
  review:
    status: draft
    reviewers: []
    last_reviewed: null
  signing:
    method: ed25519
    key_id: null
    pubkey: null
    digest: 4de8508dc437ab3db7acc4e6e4000e61694a551677ddf981a763cf68ca3f6a49
    signature: null
applies_to:
- conversation
- support
dependencies: []
incompatible_with: []
security:
  sensitivity: medium
  notes: ''
