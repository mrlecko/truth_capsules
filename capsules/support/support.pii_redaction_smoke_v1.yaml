id: support.pii_redaction_smoke_v1
version: 1.0.0
domain: support
title: PII Redaction Smoke Test
statement: 'Ensure bundled examples contain no plaintext PII. This check scans example
  transcripts

  (default: artifacts/examples/support_agent/examples.txt) for emails, phone numbers,

  credit card patterns, government ID keywords, street addresses, and IP addresses.'
witnesses:
- name: no_plaintext_pii_in_examples
  language: python
  code: "import os, sys, re, json, glob\n\ndef find_files(path):\n    if os.path.isdir(path):\n\
    \        for ext in (\"*.txt\", \"*.md\", \"*.log\"):\n            for p in glob.glob(os.path.join(path,\
    \ ext)):\n                yield p\n    else:\n        if os.path.exists(path):\n\
    \            yield path\n\nEMAIL = re.compile(r\"[A-Z0-9._%+-]+@[A-Z0-9.-]+\\\
    .[A-Z]{2,}\", re.I)\nPHONE = re.compile(r\"(?:\\+?\\d{1,3}[\\s\\-\\.]?)?(?:\\\
    (?\\d{3}\\)?[\\s\\-\\.]?\\d{3}[\\s\\-\\.]?\\d{4})\")\nCCARD = re.compile(r\"\\\
    b(?:\\d[ -]*?){13,19}\\b\")\nGOVID = re.compile(r\"\\b(?:SSN|NIN|SIN|CPF|DNI|Aadhar)\\\
    b\", re.I)\nADDRESS = re.compile(r\"\\b\\d{1,5}\\s+\\w+\\s+(?:St|Street|Ave|Avenue|Rd|Road|Blvd|Lane|Ln|Dr|Drive)\\\
    b\", re.I)\nIPADDR = re.compile(r\"\\b(?:(?:\\d{1,3}\\.){3}\\d{1,3})\\b\")\n\n\
    MASKED_TOKENS = re.compile(r\"\\*\\*\\*|\\[redacted\\]|\\[masked\\]\", re.I)\n\
    \ndef main():\n    examples_path = os.environ.get(\"EXAMPLES_PATH\", \"\").strip()\n\
    \    fail_on_any = os.environ.get(\"FAIL_ON_ANY\", \"true\").lower() == \"true\"\
    \n\n    if not examples_path:\n        print(json.dumps({\"ok\": False, \"error\"\
    : \"EXAMPLES_PATH not set\"}))\n        sys.exit(2)\n\n    patterns = {\n    \
    \    \"email\": EMAIL,\n        \"phone\": PHONE,\n        \"credit_card\": CCARD,\n\
    \        \"government_id\": GOVID,\n        \"street_address\": ADDRESS,\n   \
    \     \"ip_address\": IPADDR,\n    }\n\n    findings = []\n    total_lines = 0\n\
    \n    for fp in find_files(examples_path):\n        with open(fp, \"r\", errors=\"\
    ignore\") as f:\n            for ln, line in enumerate(f, 1):\n              \
    \  total_lines += 1\n                if MASKED_TOKENS.search(line):\n        \
    \            continue\n                for tag, rx in patterns.items():\n    \
    \                for m in rx.finditer(line):\n                        findings.append({\"\
    file\": fp, \"line\": ln, \"tag\": tag, \"match\": m.group(0)[:64]})\n\n    ok\
    \ = len(findings) == 0\n    result = {\"ok\": ok, \"total_lines\": total_lines,\
    \ \"violations\": findings}\n\n    print(json.dumps(result, indent=2))\n    sys.exit(0\
    \ if (ok or not fail_on_any) else 1)\n\nif __name__ == \"__main__\":\n    main()"
  env:
    EXAMPLES_PATH: artifacts/examples/support_agent/examples.txt
    FAIL_ON_ANY: 'true'
  success_message: No PII found in examples.
  failure_message: PII detected in examples. Redact or mask before shipping.
provenance:
  schema: provenance.v1
  author: John Macgregor
  org: Truth Capsules Demo
  license: MIT
  source_url: https://example.com/truth-capsules/support
  created: '2025-11-10T18:12:37Z'
  updated: '2025-11-10T18:12:37Z'
  review:
    status: draft
    reviewers: []
    last_reviewed: null
  signing:
    method: ed25519
    key_id: null
    pubkey: null
    digest: badaf4a2bebc31196fd95d6475f8c45d2ebbc234e2921362e4767a6b8b0607cd
    signature: null
applies_to:
- conversation
- support
dependencies: []
incompatible_with: []
security:
  sensitivity: medium
  notes: ''
