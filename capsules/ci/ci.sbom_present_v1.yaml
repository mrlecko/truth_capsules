id: ci.sbom_present_v1
version: 1.0.0
domain: ci
title: SBOM Present for the Release
statement: 'A Software Bill of Materials (SBOM) must be attached to every release
  artifact.

  The SBOM file must exist, be non-empty, and parse as JSON or SPDX tag-value text.'
witnesses:
- name: sbom_file_exists
  language: python
  entrypoint: python3
  args: []
  env:
    ARTIFACTS_DIR: artifacts/examples/ci
    SBOM_NAME: sbom.json
  timeout_ms: 4000
  memory_mb: 128
  net: false
  fs_mode: ro
  code: "import os, json, sys\n\ndef is_nonempty_file(path):\n    try:\n        return\
    \ os.path.isfile(path) and os.path.getsize(path) > 0\n    except Exception:\n\
    \        return False\n\ndef try_parse_json(path):\n    try:\n        with open(path,\
    \ \"r\", errors=\"ignore\") as f:\n            json.load(f)\n        return True,\
    \ \"json\"\n    except Exception:\n        return False, None\n\ndef try_spdx_tagvalue(path):\n\
    \    try:\n        with open(path, \"r\", errors=\"ignore\") as f:\n         \
    \   head = f.read(2048)\n        return \"SPDXVersion:\" in head or \"PackageName:\"\
    \ in head\n    except Exception:\n        return False\n\ndef main():\n    artifacts\
    \ = os.environ.get(\"ARTIFACTS_DIR\", \"artifacts/examples/ci\")\n    name = os.environ.get(\"\
    SBOM_NAME\", \"sbom.json\")\n    path = os.path.join(artifacts, name)\n\n    exists\
    \ = is_nonempty_file(path)\n    parsed = False\n    fmt = None\n    if exists:\n\
    \        ok, fmt = try_parse_json(path)\n        if not ok:\n            if try_spdx_tagvalue(path):\n\
    \                parsed = True\n                fmt = \"spdx-tagvalue\"\n    \
    \        else:\n                parsed = False\n        else:\n            parsed\
    \ = True\n\n    result = {\"ok\": exists and parsed, \"path\": path, \"exists\"\
    : exists, \"parsed\": parsed, \"format\": fmt}\n    print(json.dumps(result, indent=2))\n\
    \    sys.exit(0 if result[\"ok\"] else 1)\n\nif __name__ == \"__main__\":\n  \
    \  main()"
provenance:
  schema: provenance.v1
  author: John Macgregor
  org: Truth Capsules Demo
  license: MIT
  source_url: https://example.com/truth-capsules/ci
  created: '2025-11-10T21:10:00Z'
  updated: '2025-11-10T21:10:00Z'
  review:
    status: draft
    reviewers: []
    last_reviewed: null
  signing:
    method: ed25519
    key_id: null
    pubkey: null
    digest: d728e897d272b08f73e479d03193609c61f2ea9aed1292e320578dfa58dafbc5
    signature: null
applies_to:
- ci
- release
security:
  sensitivity: medium
  notes: Runs in restricted CI; no network by default; read-only FS recommended.
